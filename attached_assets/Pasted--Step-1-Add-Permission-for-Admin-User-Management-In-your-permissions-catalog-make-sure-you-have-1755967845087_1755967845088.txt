ðŸ”¹ Step 1: Add Permission for Admin User Management

In your permissions catalog, make sure you have:

{
  "code": "user.manage",
  "description": "Manage users (add, edit, assign roles)"
}


This will allow access to the Admin Users page where new users are created and roles are assigned.
Only roles like staff or super_admin should have this permission. Customers should not.

ðŸ”¹ Step 2: Update Admin Users Page

When rendering the Admin Users page in frontend:

Check for user.manage permission

If missing â†’ hide the entire page or show â€œAccess Deniedâ€

If present â†’ show full UI for creating users, assigning roles

Example (pseudo-code):

if (permissions.includes("user.manage")) {
   showAdminUsersPage();
} else {
   showAccessDenied();
}

ðŸ”¹ Step 3: Create Test Roles

Insert roles + permissions into DB so you can test:

Customer Role

agreement.create, agreement.view.own, agreement.edit.own

Staff Role

agreement.view.all, agreement.edit.all, agreement.import, user.manage

Super Admin Role

(all permissions)

ðŸ”¹ Step 4: Testing Instructions

Login as Customer

Try accessing Admin Users page â†’ âŒ should be denied (no user.manage).

Try creating an agreement â†’ âœ… should work.

Try editing someone elseâ€™s agreement â†’ âŒ denied.

Login as Staff

Access Admin Users page â†’ âœ… should be allowed.

Create a new user (assign Customer role).

Verify that new user only sees their own agreements.

Login as Super Admin

Access Admin Users page â†’ âœ… allowed.

Assign staff role, customer role, etc.

Verify unrestricted access to everything.

ðŸ”¹ Step 5: Auto-Check with Middleware

Add test routes just for verification:

// Only users with user.manage can hit this
app.get('/api/admin/users', requirePermission('user.manage'), (req, res) => {
  res.json({ msg: "You can manage users!" });
});


Try hitting it with different users:

Customer â†’ should get 403 Forbidden

Staff â†’ should get success

Super Admin â†’ should get success

âœ… With this, youâ€™ll be able to test RBAC end-to-end by creating users on the Admin Users page, assigning them roles, and verifying permissions through both UI and API.